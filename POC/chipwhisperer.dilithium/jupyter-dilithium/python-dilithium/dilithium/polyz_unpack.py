import numpy as np

import dilithium
import dilithium.generic

sk = b'\x1f@\xed\xa0\xc2\x12Q\xc5X\x9d\x86]\xf2_\xe4\x17\x8e\x9eI\x94\xed3p!\xb5d\x94\xb02=\x84\xe3\xb9\xa2\x1a\xfes \xfe\x9c:\x7f"R\xfa\xd4~\x87\xc4<\xc0m-\x00G\x83\xe2\x043\xfe\x82\xe5\xbcx\x10?\xb0\xed\xa5\xe2\x83\x96\xefv!\x04.\xef\x0e-H\xa1\xb12\xa0\xa7\xd2V\xae\x97\xee`\x01P\x1bU\n\xb8\x11\x04\x86\x08D&\n\x19\xa70\x82"\x91\x0c%j\x1c\x10D\xa1\x18\x86\xc4\xc4%\x01\xa3\t\x11\x82!\xd0\x86-\xc32-\x12\x85D\xd8\x10h\x11\xc11\x92\x94l\x980\x02\x98\x18(\x89\x06\x91Y0A\xdc\x00LT\xb6\x80d"I\x99\x82qB\x18\x92\xdaB\x05L\xc2P\x144\x86\xa4\x90!\xe0\xc8-\x1b%d\xd1\x92\t\x81D\x80\xdb&&PB\x08\xdb\x82\x8dd\x88A\x1b\xa8(\xd0\xb8 \xc1\xc4\x00!\xc9!`B\n\x1aA\t\x1b\x08!\n@\x10\x9cH\x85\x88\x02\x0cA\x06!\x02\'b\xd0\x14(##2@@\x04\x00\x82\x01\x1c\xc3P`\x04\x81\x0b\x81L\xcc\xc4\x8d\x8b\xc2\x81\xe20"\xd0@-\x80\xa0\x85\xcaH\x91\xe2\xa4@T2\x8a\x9a\x122X&\x08\xd8\x14n\x1b\x17\x00H\x12\r#\x17&\x8c4\x85\x0b\xb8D\x10G*\x12\x84,I\x04$I(\x08X&h$\x93M\x1b\xc0i\x0b$P\x1a\x11&\xa1\x180\x1a\t\rQ"\x11\xc3BQ\x00$0\xc4\x06J\x89\xc8\x08Q2\x8e\x02\x98h\x90F\x89\x13CfS\x10\x81\x008&X6R\xda\xa4\x01\x1a\x14\r\x03\x89\x10\xc96\x82b\x06B\x04\xa3P\xe0 %\xd4\xc2p\xc1\xc0q\x93\x86(\x10\'\x8e\x00\x04\x8a\xd8&,\x1b1a\t\x90aS\x02,\x01@F\x01\x92\x01\x99\xa0L\x02#I\x02\xa3H\xe3\x92H\x83HnC\x00F\x9a\xb2\x85\x03\xb1\x80\x0bEi\xe1\x08\x90R\xb2i\xc1\x04D\x0bFR\x0c\x84\r\x030.C\x04P\x1c\x96`B\x04\x92\xd42p!\x18\x04\xa32\x00a\x96,\x91\x02E\x94\xa2\x8c\x185qS\x92Q\x02\xb5M\x1cBEb8M"%\x88\x90\x08\n\x1a\x02\x10\xc8\x10f\x91\xa8\x8c\xda\xc0d\x14\xc6$[\xc0`\x10\x97(\xda\x04\x90\n\xb1\x91\xe4\x12\x91\x920*\xcc"aa\xb0 \x00\x11ac\x92( \xc6%\x109j\n5q\x8bF,\x0b\x16\x11S\x02\x8e\x9c\x84\x0c\x1c\x83\x80\x0bH2\x89\xb6\x91\n\x08\x88S\xb8a\xc1B&$\'\x02\xdb$.\xe3\x04\x8e#\x86\x80\x02\x18N\x910\x12\x14ER\xc9\x84\x80\x0b\xc4eZ\x18\x92\\&\x0e\x08\x08\x0c\xd92\x06\x003\x90\xda8IS\x14P\x13\x15\x8c\x98\x10EJ\xa4!\xc4\xc6p\xd18p\x83\x06,\t4\x91\x10")\xa1\x96\x08"\x14*\x92D\r\xd2\x00P\x0b"j\xd0Db\x9c\x96\r$\x04q\x048\x0e\x80\x08D\xe1\xa8dT2\x10\x84 \x81S\x16n\x89\x00P\xc8@.\x0b2(\x81\xc2a\x0c\x14\x05"\xa5i\x10\xc2\x01\xda&q"Ei\x98\xa0i\xa3\x94eL$D \xc2e\nH\x10\x1c\xa0\x8d\x8c2PJ\x82mc\xb6\x91\xa0&\n\x89\x82%\x0b\x91a\x12!\x08\x82@\x06\x00I\x04\xd8\xb6,D\xa0\x01\xda\xb6-\x01",Y\x06P\x1c\x05\x8a\x0b\xc0E\n&m\x03\x89@\x0c\x08\x01\x88\xa2 @\xb61\x184E#3"\xcc \n\x110"\x18\xa3\x90\x12\x08&\x90\x08\x91\x8c\xc6A\x0bB02;\xca9\x158\x0c\xa7T\xf1\xfc\xca\xd59\xc9Y\x8d\x81K\x90W\x9e\xa4\x05\x12l\xd0Jg\x17\xed\x151#\xa2\x1f\xd5\\\xc0\xf9!\x883/\x1dg\x96\x17\xfb0\x01\xf1\xd5\xe9\xc2\x90\'\xd03U\x9fl\x1e\xecO\xa3F=\t\xddP\x03\x82\x18\xfb\x1d\x0c\xa4|\xad\x02\xcf8\xd1\x15\xe0\x88\x98\xc6\xe6\x89L\x890T`Cj\n\xf5\x0eP\x03i\xdd\x8d\xe7\x87t\xc5\xac\xdd\xce\x1e\x95#x\x10\xe5vvo]k\xee6z\x0c\xd1\xaa\x05\x12.\xaf\xb3\xc5Fj]\xb8\xf5\xf0\x8f\xc1\xb4\xb3D\x15\x9b4\x93\xba\x98\x04\xe2\xebi\x9e\x0f`\xa9v5\x9dDU6\x96\x01\x1d0\xb5\x16t\xd7\x1e\xb3\x1a\xf8\xa1\x05\xdeI.I\xbf;|.\xd4*\xc5\x08]\xcf\x11\t\xd5/\x18\xea/\x91\xd8\xd0\xcd\xbf\xb2\x1d\x0c\x849\xcc\xd0\x8c\x01\xe2\xfa.O\xf7p\xc9Kz&06(^O\x91\x11\x88%g\xe9\xfcZ\xd8~]\x06\x08\x9e\xb4\xe0\x10\xe3\x8b7\xd2\x97?\xd9\x8e\xa58\x80>\xfb)4+.\x07\xf0\'x\xb2\xe0R\x19_C\x8ffs\xb6\xab!\xff\xa7r\xf9\x8b\x05\x84\x15,\x9a\xc9\x16w\x80]\xd0n\xfd~j\x9a\xbdu@W\xfe\xa4\xff!\xdeg\x99g\xba\xbc\xb9\x02SJ\x9ep)\xc09\xef\xac\x10\xcd\x93cz\xcb\xa82\t\x8d\x0bEEG\xdb+r\xdd\x80\x17\xd2AdS\x99\xfc\r\x93i\xc0O\xc6\x8e\xc9R\xdc\xe86[Q=\xa0C\xe6\xe4\xb8\x88h\x80w\x93\xb1j\x89t\x83\xe2\xc4\xb9\x92V?\xd2p\xd9\x17\xb2\x9b\xb2t4\xf4\xf0\x96O2\xe7\xbdl\xf9\xe2\xcfdj\xf9-\x1b\xa4[\xcd(\x98\xbb\x98\xe4\xe2\x0e\xa4\xd7\nB\xa1~\xfey\x8d\xcd~\x1fDX\x1e)W2I\xf2\x1e\x97N\x82l=\x0e\x94\xad\xb9\xd0W\xce\x1b\x93l\x8f\x1e\xaff4\x98\xf6I\xa4\xc6\xa5l\xc0\xb7\xc7x\xad\x1a\xad\x08v;\x07\x86\xee\xf2\x15\x170\xe4\xb1\xaf\xb9\x14\r\xd3VV\x94\x83 \x93\x9a\x0f_Cc\xf2\xdb\xa4Z\x9at\x10n\xd7(\x7f\xfc\xd1\xc9$\xed\x00\xd7\xe7d)\xd6\xe4\xae"p\xab*2\xb6\xccrC\xc4\xe9\xcd\x8b\xc4\xa3\xbe\xe7\xc6\xe6\xe8\xe7>&\x12\xefJ\xe7\xe1\x837L C\xfd\xe8\xa3]\x17%\xa6\n\x0f\x8b6\xcf+\x123\xec\xc3\xe0\xd8\xc7\n\xdar\x89\x1b\xef-\xe0\x93\xad\x7f\x80\xc8\xeb|\x01\'!z\xee\xf5T5-\xdd=(g\xe1g\xac\xf5h\xfd\x17{K\xfe\x84/\x8f\xee\x9a\x0e%\xd8>/\xdc\xb3\xdfM\x0e\xc8+\xf2\xf0>\x8b\n\xce\xeb\xee\x05\xb1\xa4ovK!\xde8\xado\x10\xb3\xdb\xef]\xfb\xa1\xbc4X\x80I}\xbbj\x00I-0R\xc1?+\r\x0cp@,L\x90\xfa\xc4\xe3d/\x1a\xe2\x82\xaf\xc1\x81\xb9\\ \xf4\xdbk\xa0\xbb0]\x83\'y\x01-4\x06\x96\xfei\x08\xd0\x93\xa1Y\xda\x84\xc7\xceUM\xcbM\xa6\xd5\x1c\x9e\x89\xb0\x08QT\xf9KF\xfb\x8a\x85\xaaA\xf5\x9f{<\xe6\xaa\xd6\xfe\xb1\xc0Ld\xa8\x18\x93Kq\xd4\x99\x0e\x8e\xf5\t\xa3\x97\xb9]I\xe6\xc7,\xc9\r\\\x8e\xde\xc1a\xcd<D\xdfk\xc2\x8e\xa1\xf2\x87\x8c\x8aK\xf8dr\xb9\x9d+\x97\x1b\xd5\xce\xb5C\xe0\x07\xe8\x99\x859\xd0\xeb4\x87\x08m\x0b\xce\xb4q\xfb\xfb\xefq(\xc4;\x96\xad\x96l\x14x\xeeJ\x1f\xfe*\xea\xa0\xfd\xae\xd2\xb4\xec\xe7.\xdb\xb9>\xe4\x00\x80e&\xe9!5y\xd8\xd3\xa3\xdbAw\x1f\xa4\x19\x1c\xa9)f\xd9\x88$\xf6\xd1\x14\xbe\n\xa4m\x94w[\xf6\xde}\xf8[\x83\x0b\xb1\xe8x\x87\x19rn\xc1\x82\xc1\x03e+\xfe\xcb\xc3\xcf!\xf3\xba\xa0z\xee**\x93\xf9+\xafLf%\xe7\x08.\xf7\xc4\xf9\x0b\xe8\xd6I0<\x18z\x86\xa5|\x9e\x01\xb98\xc8.\xc7j\x03\xcf\x06y\xc8(\x180\x96\x8c\xc6\xaa\xe4\xd2@#\xa3E\x1b1\xe8d0\\\'\xa4F\xc6RA\xfc\xf8\x03\x89\xdf\x93\xac-\x12`d"3\xba)\xbd\xd3\xd4Q\xb6\x86Y\x07b)0W\x9fl2j\xb3\xf8\xbd\x08^\xed"\xb9*\xcad\xc8\x1d\x15\xe5C\x0b\xd3\x01\x13\x10\r\xf9$\x1e\xdc8\xe6Po\xaf\xce\xed(A3\x99\x14\xe9:\xe7\x17\xea\xc1\xc6\xe0\xbb\xc8}\xc4\x83\x8a*\x01\xd8"\xd2F\x1f\x9a2\xab\xd3L{\xc2\xc0\x07\x16\xab\x19\xf9\xc9f\x82\xc1\xbeN\x8c\x82*\xba\xd0\xc4\x0b#\xe6u\x12(\x8f\rv\x9d\xad\x8bxr\xeb\xa3g\x00\xadF\xfa\x90\x00\xeemi\xa2:\xcc\x1e\x9api\xac\xc7\xc8\xc7\xbeZ\x17"\xc7\x96\xc7\x88\xf5\xbd2\x1a!b{\xd6\xa5K\x13\x99\x8b\x04\xfe\xe1s\x9d;\x9c\x88c\xba9\\\xcaV\xf2\xf1%D\xf7|\xd7\xcapgT\xb7Z20\x15r\xd5r\xf8\x18\xd4\xdb\xe3\x1dL\x1e\xaa:\xc3\x9f\xb3;\x11\x1d\xdbW\x8a\x8a\x10\xfc<\xed\x9e\xeaG\x8b\xf1^\x8d3z*x$\xfc\xec\x85\x01\x1b\xf4h\xed\xaf\x8aK~\x18\xc3\x95w\xb0\xd6B=9\xce\x9c^\xcf\x97\xe4&\x16?F\xc7`-1U\x98w\x04\x0f\x06E5\xd3\xf8\xcc\t\xa7\xe6\x13V\x15(\x82X\x16\x17\xea\xe2\xc5\xa2D?\xe9\x05*\x12}e%\xef\x9f\x93<-\x89\x19\x81EK`\xaa\x87\x1fXR\xa7\xde\xb1\xaf\x994}3F]X\xf8`\xcb\x06\xa8\xf0\xda\x89\x1c\x006\xf5a\x0f\xa9\t\xecbg\xb1|\x0e\xcb\x97\x15\xed\xd6<w\x9c\xd1\xa6\x93*\xa2p\xd8)\xd4\x0ca\xb0{\x89\xbbeY\xf7\xdf\xea\xc8\xdc`\xeb|\x93\xd0\x9fJ\xe5~\xa0[kW\xf4?\xc9\xce8\xea\x01\t!j\xf3\xa92fg+K\x0c\xc8\x1c{\xf6\x05*>?\xf0\x99\xa5\x08\xd5\x0c\xbcrd\xcc\x83j`hw\xb7\xdc\xe7\xf0\xd2\xf5\xe9<\xd3\xfdH\x14NK\xf4\xc8\xa4\xe9\x89\xc5\x9c\xfe\x96\xdc\xf5\x11\x08\xb45\x14\xcf_\x82X\xb5\xb3\x90\xd9q\xf9\xf6\xe1Q=8\x9c\xf1\xa7\xdc\xf2\xd2\x10\xef\x03\xb3\xe6\xb8\xd6\x8c\x91\xc9\x87~\x19E\xd0A2\xb0_[X\x04\x1c\x8c\xdc\xaa\xb9\x0e\x9b\x80,Z#\xec\xea\x8b\xb4u\xe8\xb8\xcf\xa7@\xda\xe2\xbcc\xe7\xa1\xca|\xf9\xde\xdc\x17\xbfW\x00W\x1e\x1d"BHX\x96\x1b\xfb\xc0</\xee1~20Nd\xbe\x13\x9e\x16D\t\x93]\x10\xfb\xd1t\xba\x90\xb0$\x0b\xe2~\xee\xcb\x93\x98\xffd\xb1\xe8\x0f\\\xc0\xfd\xbft\x1a{K\xde\xdf\x95\xa2+\xa1Y\xb4<\xd4GiEK\xce5|\x83\xc0\xdb\xf3=\x07\xf7\xa6\x1dI\xcf\xb3\x81\x9e\x11\xda\xe2\xc1\x19C\xe4\xcf\xa2nZh$[\x17{\x0e\x91T\x8d\xacS\xae\xc7\x9d\n:\x1f\xc6\xacfD\xd1\x82\xb3\x9a'


__NIST_SECURITY_LEVEL = 2
__POLYZ_PACKEDBYTES = dilithium._params[__NIST_SECURITY_LEVEL]['POLYZ_PACKEDBYTES']
__GAMMA1 = dilithium._params[__NIST_SECURITY_LEVEL]['GAMMA1']
__FAULT_ITER = 2


def main() -> None:
    expected = dilithium.generic._polyz_unpack(sk[:__POLYZ_PACKEDBYTES], nist_security_level=__NIST_SECURITY_LEVEL)
    print(expected)
    zero = sk[:__FAULT_ITER * 9] + (b'\x00' * (__POLYZ_PACKEDBYTES - __FAULT_ITER * 9))
    polyz_unpacked = dilithium.generic._polyz_unpack(zero, nist_security_level=__NIST_SECURITY_LEVEL)
    polyz_unpacked_new = dilithium.generic._polyz_unpack_new(zero, nist_security_level=__NIST_SECURITY_LEVEL)
    assert np.all(polyz_unpacked[:__FAULT_ITER * 4] == expected[:__FAULT_ITER * 4]) and np.all(polyz_unpacked[__FAULT_ITER * 4:] == 2 ** 17)
    print(polyz_unpacked)
    print(polyz_unpacked_new)
    print('Goodbye!')


if __name__ == '__main__':
    main()
